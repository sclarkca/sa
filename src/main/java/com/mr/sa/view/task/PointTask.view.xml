<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="PointTask">
      <Property name="creationType">com.mr.sa.entity.BizPointTask</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">任务名称</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="doneRatio">
        <Property name="dataType">Integer</Property>
        <Property name="label">完成比例(%)</Property>
        <Property name="required">true</Property>
        <Property name="defaultValue">100</Property>
      </PropertyDef>
      <PropertyDef name="activeFlag">
        <Property name="dataType">String</Property>
        <Property name="label">激活标记</Property>
      </PropertyDef>
      <PropertyDef name="activeTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">激活时间</Property>
      </PropertyDef>
      <PropertyDef name="patrolStartDate">
        <Property name="dataType">Date</Property>
        <Property name="label">巡防开始日期</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndDate">
        <Property name="dataType">Date</Property>
        <Property name="label">巡防结束日期</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="activeStatus">
        <Property></Property>
        <Property name="label">状态</Property>
        <Property name="mapping">
          <Property name="mapValues">${dorado.getDataProvider(&quot;enumProvider#getValues&quot;).getResult(&quot;PATROL_TASK_ACTIVE_STATUS&quot;)}</Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="integralTask">
        <Property name="dataType">Boolean</Property>
      </PropertyDef>
      <PropertyDef name="integralValue">
        <Property name="dataType">Integer</Property>
      </PropertyDef>
    </DataType>
    <DataType name="Condition">
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">任务名称</Property>
      </PropertyDef>
      <PropertyDef name="patrolStartTime_startTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">巡访开始时间(起)</Property>
      </PropertyDef>
      <PropertyDef name="patrolStartTime_endTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">巡访开始时间(至)</Property>
      </PropertyDef>
      <PropertyDef name="patrolStartTime">
        <Property name="dataType">String</Property>
        <Property name="label">巡访开始时间</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndTime_startTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">巡访结束时间(起)</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndTime_endTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">巡访结束时间(至)</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndTime">
        <Property name="dataType">String</Property>
        <Property name="label">巡访结束时间</Property>
      </PropertyDef>
      <PropertyDef name="doneRatio">
        <Property name="dataType">String</Property>
        <Property name="label">完成比例(%)</Property>
      </PropertyDef>
      <PropertyDef name="activeFlag">
        <Property name="dataType">String</Property>
        <Property name="label">激活标记</Property>
      </PropertyDef>
      <PropertyDef name="activeTime_startTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">激活时间(起)</Property>
      </PropertyDef>
      <PropertyDef name="activeTime_endTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">激活时间(至)</Property>
      </PropertyDef>
      <PropertyDef name="activeTime">
        <Property name="dataType">String</Property>
        <Property name="label">激活时间</Property>
      </PropertyDef>
      <PropertyDef name="activeStatus">
        <Property></Property>
        <Property name="label">状态</Property>
        <Property name="mapping">
          <Property name="mapValues">${dorado.getDataProvider(&quot;enumProvider#getValues&quot;).getResult(&quot;PATROL_TASK_ACTIVE_STATUS&quot;)}</Property>
        </Property>
        <Property name="defaultValue">2</Property>
      </PropertyDef>
    </DataType>
    <DataType name="PointTaskItem">
      <Property name="creationType">com.mr.sa.entity.BizPointTaskItem</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">id</Property>
      </PropertyDef>
      <PropertyDef name="pointTaskId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="patrolStartTime">
        <Property name="dataType">Time</Property>
        <Property name="label">开始时间</Property>
        <Property name="defaultValue">00:00:00</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndTime">
        <Property name="dataType">Time</Property>
        <Property name="label">结束时间</Property>
        <Property name="defaultValue">00:00:00</Property>
      </PropertyDef>
      <PropertyDef name="timeInterval">
        <Property name="dataType">Integer</Property>
        <Property name="label">时间间隔(分钟)</Property>
        <Property name="defaultValue">60</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="timeRedundancy">
        <Property name="dataType">Integer</Property>
        <Property name="label">时间误差(分钟)</Property>
        <Property name="defaultValue">5</Property>
        <Property name="required">true</Property>
        <Property name="mapping">
          <Property name="mapValues">${dorado.getDataProvider(&quot;enumProvider#getValues&quot;).getResult(&quot;TIME_REDUNDANCY&quot;)}</Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="acrossDay">
        <Property name="dataType">Boolean</Property>
        <Property name="label">跨天</Property>
      </PropertyDef>
    </DataType>
    <DataType name="Org">
      <Property name="creationType">com.mr.sa.entity.Org</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">ID</Property>
      </PropertyDef>
      <PropertyDef name="code">
        <Property></Property>
        <Property name="label">编码</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="longitude">
        <Property></Property>
        <Property name="label">经度</Property>
      </PropertyDef>
      <PropertyDef name="latitude">
        <Property></Property>
        <Property name="label">纬度</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property></Property>
        <Property name="label">地址</Property>
      </PropertyDef>
      <Reference name="children">
        <ClientEvent name="beforeLoadData">var parameter=self.get(&quot;parameter&quot;);&#xD;
 var entity = view.get(&quot;#dsPointTaskItem&quot;).getData(&quot;#&quot;); &#xD;
var selectionPatrolTaskItem = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
console.log(selectionPatrolTaskItem)&#xD;
parameter.set(&quot;selectionPatrolTaskItem&quot;,selectionPatrolTaskItem);&#xD;
</ClientEvent>
        <Property name="dataType">[SELF]</Property>
        <Property name="dataProvider">bizPointTaskItemController#loadChildrenOrg</Property>
        <Property name="parameter">
          <Entity>
            <Property name="parentId">$${this.id}</Property>
          </Entity>
        </Property>
      </Reference>
      <PropertyDef name="checked">
        <ClientEvent name="onSet">var orgId = arg.entity.get(&quot;code&quot;);&#xD;
var selectionPatrolTaskItem = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
var paraSave = {&#xD;
	'selectionPatrolTaskItem': selectionPatrolTaskItem,&#xD;
	&quot;orgId&quot;: orgId&#xD;
}&#xD;
&#xD;
if (arg.value) {&#xD;
	//view.get(&quot;#aaSaveOrg&quot;).set(&quot;parameter&quot;, paraSave).execute(function(result) {});&#xD;
	//view.get(&quot;#aaSaveOrgPlan&quot;).set(&quot;parameter&quot;, paraSave).execute(function(result) {});&#xD;
} else {&#xD;
	view.get(&quot;#aaDeleteOrg&quot;).set(&quot;parameter&quot;, paraSave).execute(function(result) {&#xD;
	//view.get(&quot;#aaDeleteOrgPlan&quot;).set(&quot;parameter&quot;, paraSave).execute(function(result) {})&#xD;
	})&#xD;
}&#xD;
&#xD;
//var paraQueryOrgPlan = {&#xD;
//	'pointTaskItemId': pointTaskItemId&#xD;
//}&#xD;
//view.get(&quot;#dsOrgPlan&quot;).set(&quot;parameter&quot;, paraQueryOrgPlan).flushAsync();</ClientEvent>
        <Property name="dataType">boolean</Property>
      </PropertyDef>
    </DataType>
    <DataType name="RelPointTaskItemOrg">
      <Property name="creationType">com.mr.sa.entity.BizPointTaskItemOrg</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">id</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="orgId">
        <Property></Property>
        <Property name="label">组织ID</Property>
      </PropertyDef>
      <PropertyDef name="pointTaskItemId">
        <Property></Property>
      </PropertyDef>
    </DataType>
    <DataType name="RelPointTaskItemPoint">
      <Property name="creationType">com.mr.sa.entity.BizPointTaskItemPoint</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">id</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="required">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否为必扫点</Property>
      </PropertyDef>
      <PropertyDef name="pointTaskItemId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="orgId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="pointId">
        <Property></Property>
      </PropertyDef>
    </DataType>
    <DataType name="ConditionPatrolPoint">
      <PropertyDef name="code">
        <Property name="dataType">String</Property>
        <Property name="label">编码</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="pointTaskItemId"/>
      <PropertyDef name="selectionPatrolTaskItem"/>
    </DataType>
    <DataType name="PatrolPoint">
      <Property name="creationType">com.mr.sa.data.vo.PatrolPointVO</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="code">
        <Property name="dataType">String</Property>
        <Property name="label">编码</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="longitude">
        <Property name="dataType">String</Property>
        <Property name="label">经度</Property>
      </PropertyDef>
      <PropertyDef name="latitude">
        <Property name="dataType">String</Property>
        <Property name="label">纬度</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property></Property>
        <Property name="label">创建日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property></Property>
        <Property name="label">修改日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="importDetail">
        <Property></Property>
        <Property name="label">导入详情</Property>
      </PropertyDef>
      <PropertyDef name="checked">
        <Property name="dataType">boolean</Property>
        <Property name="label">勾选</Property>
      </PropertyDef>
      <PropertyDef name="required">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否为必扫点</Property>
      </PropertyDef>
      <PropertyDef name="qrcodeUrl">
        <Property></Property>
        <Property name="label">二维码地址</Property>
      </PropertyDef>
      <PropertyDef name="qrCode">
        <Property></Property>
        <Property name="label">二维码</Property>
      </PropertyDef>
      <PropertyDef name="orgId">
        <Property></Property>
        <Property name="label">组织ID</Property>
      </PropertyDef>
      <PropertyDef name="level">
        <Property></Property>
        <Property name="label">级别</Property>
      </PropertyDef>
      <PropertyDef name="type">
        <Property></Property>
        <Property name="label">类型</Property>
      </PropertyDef>
    </DataType>
    <DataType name="RelPatrolTaskItemUserAmount">
      <Property name="creationType">com.mr.sa.entity.BizPointTaskItemUserAmountRel</Property>
      <PropertyDef name="orgId">
        <Property></Property>
        <Property name="label">单位ID</Property>
      </PropertyDef>
      <PropertyDef name="memberAmount">
        <Property name="dataType">int</Property>
        <Property name="label">巡防队员</Property>
      </PropertyDef>
      <PropertyDef name="copAmount">
        <Property name="dataType">int</Property>
        <Property name="label">巡防民警</Property>
      </PropertyDef>
      <PropertyDef name="apAmount">
        <Property name="dataType">int</Property>
        <Property name="label">巡防辅警</Property>
      </PropertyDef>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">id</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="pointTaskItemId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="orgName">
        <Property></Property>
        <Property name="label">单位名称</Property>
      </PropertyDef>
    </DataType>
    <DataType name="Copy">
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="patrolStartDate">
        <Property name="dataType">Date</Property>
        <Property name="label">巡防开始日期</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndDate">
        <Property name="dataType">Date</Property>
        <Property name="label">巡防结束日期</Property>
      </PropertyDef>
    </DataType>
    <DataType name="CopyItem">
      <PropertyDef name="patrolStartTime">
        <Property name="dataType">Time</Property>
        <Property name="label">巡防开始时间</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndTime">
        <Property name="dataType">Time</Property>
        <Property name="label">巡防结束时间</Property>
        <Property name="required">true</Property>
      </PropertyDef>
    </DataType>
    <DataType name="PointOrgPlan">
      <Property name="creationType">com.mr.sa.entity.BizPointOrgPlan</Property>
      <PropertyDef name="pointTaskItemId">
        <Property></Property>
        <Property name="label">巡防任务ID</Property>
      </PropertyDef>
      <PropertyDef name="orgId">
        <Property></Property>
        <Property name="label">单位ID</Property>
      </PropertyDef>
      <PropertyDef name="patrolStartTime">
        <Property name="dataType">Date</Property>
        <Property name="label">巡防开始时间</Property>
      </PropertyDef>
      <PropertyDef name="patrolEndTime">
        <Property name="dataType">Date</Property>
        <Property name="label">巡防结束时间</Property>
      </PropertyDef>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">id</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View>
    <Property name="packages">font-awesome,colors,entypo</Property>
    <Property name="title">巡逻任务信息维护</Property>
    <Container id="ds">
      <DataSet id="dsPatrolTask">
        <ClientEvent name="beforeLoadData">var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
self.set(&quot;parameter&quot;, data);</ClientEvent>
        <Property name="dataProvider">bizPointTaskController#query</Property>
        <Property name="pageSize">20</Property>
        <Property name="dataType">[PointTask]</Property>
        <Property name="loadMode">lazy</Property>
      </DataSet>
      <DataSet id="dsPointTaskItem">
        <ClientEvent name="beforeLoadData">var entity=view.get(&quot;#dsPatrolTask&quot;).getData(&quot;#&quot;);&#xD;
var pointTaskId=entity.get(&quot;id&quot;);&#xD;
var parameter={&#xD;
	&quot;pointTaskId_eq&quot;:pointTaskId&#xD;
}&#xD;
self.set(&quot;parameter&quot;, parameter);&#xD;
</ClientEvent>
        <Property name="dataProvider">bizPointTaskItemController#query</Property>
        <Property name="pageSize">20</Property>
        <Property name="dataType">[PointTaskItem]</Property>
        <Property name="loadMode">manual</Property>
      </DataSet>
      <DataSet id="dsOrg">
        <ClientEvent name="beforeLoadData">var entity = view.get(&quot;#dsPointTaskItem&quot;).getData(&quot;#&quot;);
var select = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);
var paraQuery = {
	'selectionPatrolTaskItem': select
}
self.set(&quot;parameter&quot;, paraQuery);</ClientEvent>
        <Property name="dataProvider">bizPointTaskItemController#loadOrg</Property>
        <Property name="dataType">[Org]</Property>
      </DataSet>
      <DataSet id="dsPatrolPoint">
        <Property name="dataProvider">bizPointTaskRelController#query</Property>
        <Property name="dataType">[PatrolPoint]</Property>
        <Property name="loadMode">manual</Property>
        <Property name="pageSize">2000</Property>
      </DataSet>
      <DataSet id="dsOrgPlan">
        <Property name="dataProvider">bizPointOrgPlanController#query</Property>
        <Property name="dataType">[PointOrgPlan]</Property>
        <Property name="loadMode">manual</Property>
        <Property name="pageSize">20</Property>
      </DataSet>
      <DataSet id="dsUserAmount">
        <Property name="dataType">[RelPatrolTaskItemUserAmount]</Property>
        <Property name="dataProvider">bizPointTaskItemUserAmountRelController#queryUserAmount</Property>
        <Property name="loadMode">manual</Property>
      </DataSet>
    </Container>
    <Container id="action">
      <UpdateAction id="updateAction">
        <Property name="successMessage">操作成功!</Property>
        <Property name="executingMessage">正在保存...</Property>
        <Property name="dataResolver">bizPointTaskController#save</Property>
        <UpdateItem>
          <Property name="dataSet">dsPatrolTask</Property>
        </UpdateItem>
      </UpdateAction>
      <UpdateAction id="uaPatrolTaskItem">
        <Property name="successMessage">操作成功!</Property>
        <Property name="executingMessage">正在保存...</Property>
        <Property name="dataResolver">bizPointTaskItemController#save</Property>
        <UpdateItem>
          <Property name="dataSet">dsPointTaskItem</Property>
        </UpdateItem>
      </UpdateAction>
      <AjaxAction id="aaSave">
        <Property name="service">bizPointTaskItemController#saveRel</Property>
        <Property name="successMessage">保存成功。</Property>
      </AjaxAction>
      <AjaxAction id="aaCopy">
        <Property name="service">bizPointTaskController#copy</Property>
        <Property name="successMessage">复制成功</Property>
      </AjaxAction>
      <AjaxAction id="aaCopyItem">
        <Property name="service">bizPointTaskItemController#copy</Property>
      </AjaxAction>
      <AjaxAction id="aaDeleteOrg">
        <Property name="service">bizPointTaskItemController#deleteOrgModel</Property>
        <Property name="async">false</Property>
      </AjaxAction>
    </Container>
    <SplitPanel>
      <Property name="position">60%</Property>
      <MainControl>
        <Panel>
          <Property name="caption">任务项</Property>
          <Property name="exClassName">green-text</Property>
          <Buttons/>
          <Children>
            <ToolBar>
              <Property name="fixRight">true</Property>
              <ToolBarButton>
                <ClientEvent name="onClick">var datas = view.get(&quot;#dsPointTaskItem.data&quot;);&#xD;
var pointTaskId=view.get(&quot;#dsPatrolTask&quot;).getData(&quot;#&quot;).get(&quot;id&quot;);&#xD;
var entity=datas.insert();&#xD;
entity.set(&quot;pointTaskId&quot;,pointTaskId);&#xD;
view.get(&quot;#dialogPatrolTaskItem&quot;).show();&#xD;
arg.processDefault=false;</ClientEvent>
                <Property name="caption">新增</Property>
                <Property name="iconClass">fa fa-plus</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var data=view.get(&quot;#dsPointTaskItem.data&quot;);&#xD;
if(data.current){&#xD;
view.get(&quot;#dialogPatrolTaskItem&quot;).show();&#xD;
}else{&#xD;
dorado.MessageBox.alert(&quot;当前表没有信息可供编辑!&quot;);&#xD;
}</ClientEvent>
                <Property name="caption">修改</Property>
                <Property name="iconClass">fa fa-pencil-square-o</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var updateAction = view.get(&quot;#uaPatrolTaskItem&quot;);&#xD;
var selection = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
if (0 != selection.length) {&#xD;
	view.get(&quot;#dialogTaskItemTimeConfig&quot;).show(); &#xD;
}&#xD;
else {&#xD;
    dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
                <Property name="caption">修改间隔&amp;误差</Property>
                <Property name="iconClass">fa fa-pencil-square-o</Property>
                <Property name="disabled">true</Property>
                <Property name="visible">false</Property>
                <Property name="hideMode">display</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var updateAction = view.get(&quot;#uaPatrolTaskItem&quot;);&#xD;
var selection = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
if (0 != selection.length) {&#xD;
    dorado.MessageBox.confirm(&quot;确认操作吗?&quot;, function(){&#xD;
    &#xD;
        for (var i = 0; i &lt; selection.length; i++) {&#xD;
            var select = selection[i];&#xD;
            select.remove();&#xD;
        }&#xD;
        &#xD;
        updateAction.execute();&#xD;
        view.get(&quot;#dsPointTaskItem&quot;).flushAsync();&#xD;
    })&#xD;
    &#xD;
}&#xD;
else {&#xD;
    dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
                <Property name="iconClass">fa fa-trash-o</Property>
                <Property name="caption">删除(批量)</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var selection = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);

if (0 != selection.length) {
    view.get(&quot;#dsOrg&quot;).flush();
    view.get(&quot;#dsOrgPlan&quot;).clear();
    view.get(&quot;#dsPatrolPoint&quot;).clear();
    view.get(&quot;#dialogPatrolTaskItemConfig&quot;).show();

}
else {
    dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);
}</ClientEvent>
                <Property name="caption">巡防设置</Property>
                <Property name="iconClass">fa fa-sitemap</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var selection = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
if(0 != selection.length) {&#xD;
view.get(&quot;#dialogCopyItem&quot;).show();&#xD;
&#xD;
} else {&#xD;
dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
                <Property name="caption">复制(批量)</Property>
                <Property name="iconClass">fa fa-copy</Property>
                <Property name="hideMode">display</Property>
                <Property name="visible">false</Property>
              </ToolBarButton>
            </ToolBar>
            <DataGrid id="dgPointTaskItem">
              <Property name="dataSet">dsPointTaskItem</Property>
              <Property name="dataType">PointTaskItem</Property>
              <Property name="selectionMode">multiRows</Property>
              <Property name="readOnly">true</Property>
              <RowSelectorColumn/>
              <RowNumColumn/>
              <DataColumn name="patrolStartTime">
                <Property name="property">patrolStartTime</Property>
                <Property name="align">center</Property>
                <Property name="required">true</Property>
              </DataColumn>
              <DataColumn name="patrolEndTime">
                <Property name="property">patrolEndTime</Property>
                <Property name="align">center</Property>
                <Property name="required">true</Property>
              </DataColumn>
              <DataColumn name="acrossDay">
                <ClientEvent name="onRenderCell">var acrossDay = arg.data.get(&quot;acrossDay&quot;)
var patrolStartTime = arg.data.get(&quot;patrolStartTime&quot;)
var patrolEndTime = arg.data.get(&quot;patrolEndTime&quot;)

if (patrolStartTime > patrolEndTime) {
    $(arg.dom).empty().xCreate({
        tagName: &quot;sup&quot;,
        content: &quot;跨天&quot;,
        style: &quot;margin: 2px;font-size: 10px;color: #fff;background: #ed4014;text-align: center;box-shadow: 0 0 0 1px #fff;border-radius: 10px;padding: 0 10px;&quot;
    });
}
else {
    $(arg.dom).empty().xCreate({
        tagName: &quot;sup&quot;,
        content: &quot;当天&quot;,
        style: &quot;margin: 2px;font-size: 10px;color: #fff;background: #69DA64;text-align: center;box-shadow: 0 0 0 1px #fff;border-radius: 10px;padding: 0 10px;&quot;
    });
}

</ClientEvent>
                <Property name="property">acrossDay</Property>
              </DataColumn>
              <DataColumn name="timeInterval">
                <Property name="property">timeInterval</Property>
                <Property name="align">center</Property>
              </DataColumn>
              <DataColumn name="timeRedundancy">
                <Property name="property">timeRedundancy</Property>
                <Property name="align">center</Property>
              </DataColumn>
            </DataGrid>
            <Dialog id="dialogPatrolTaskItem">
              <ClientEvent name="onClose">var data=view.get(&quot;#dsPointTaskItem&quot;).getData();&#xD;
data.cancel();</ClientEvent>
              <Property name="center">true</Property>
              <Property name="maximizeable">true</Property>
              <Property name="width">1024</Property>
              <Property name="height">500</Property>
              <Property name="modal">true</Property>
              <Property name="closeable">true</Property>
              <Property name="caption">巡防任务项详情</Property>
              <Buttons>
                <Button>
                  <ClientEvent name="onClick">var data=view.get(&quot;#dsPointTaskItem&quot;).getData();
var dialog=view.get(&quot;#dialogPatrolTaskItem&quot;);
data.cancel();
dialog.hide();</ClientEvent>
                  <Property name="caption">关闭</Property>
                  <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
                  <Property name="ui">decline</Property>
                </Button>
                <Button>
                  <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogPatrolTaskItem&quot;);&#xD;
var action=view.get(&quot;#uaPatrolTaskItem&quot;);&#xD;
action.execute(function(){&#xD;
dialog.hide();&#xD;
view.get(&quot;#dsPointTaskItem&quot;).flushAsync(); &#xD;
})&#xD;
</ClientEvent>
                  <Property name="caption">确定</Property>
                  <Property name="iconClass">fa fa-check-circle</Property>
                  <Property name="ui">highlight</Property>
                </Button>
              </Buttons>
              <Children>
                <AutoForm>
                  <Property name="labelWidth">100</Property>
                  <Property name="dataSet">dsPointTaskItem</Property>
                  <Property name="cols">*,*</Property>
                  <Property name="labelAlign">center</Property>
                  <Property name="showHint">false</Property>
                  <Property name="showHintMessage">true</Property>
                  <AutoFormElement name="patrolStartTime">
                    <Property name="name">patrolStartTime</Property>
                    <Property name="property">patrolStartTime</Property>
                    <Property name="label">巡访开始时间</Property>
                    <Editor>
                      <DateTimeSpinner>
                        <ClientEvent name="onCreate">self.set(&quot;value&quot;, new Date());&#xD;
</ClientEvent>
                        <Property name="type">time</Property>
                      </DateTimeSpinner>
                    </Editor>
                  </AutoFormElement>
                  <AutoFormElement name="patrolEndTime">
                    <Property name="name">patrolEndTime</Property>
                    <Property name="property">patrolEndTime</Property>
                    <Property name="label">巡访结束时间</Property>
                    <Editor>
                      <DateTimeSpinner>
                        <ClientEvent name="onCreate">self.set(&quot;value&quot;, new Date());&#xD;
</ClientEvent>
                        <Property name="type">time</Property>
                      </DateTimeSpinner>
                    </Editor>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">timeInterval</Property>
                    <Property name="property">timeInterval</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">timeRedundancy</Property>
                    <Property name="property">timeRedundancy</Property>
                    <Editor/>
                  </AutoFormElement>
                </AutoForm>
              </Children>
              <Tools/>
            </Dialog>
            <Dialog id="dialogPatrolTaskItemConfig">
              <ClientEvent name="onClose">var data=view.get(&quot;#dsPointTaskItem&quot;).getData();&#xD;
data.cancel();&#xD;
&#xD;
//var node=view.get(&quot;#dtOrg&quot;).get(&quot;firstNode&quot;);&#xD;
//node.doCollapse();</ClientEvent>
              <ClientEvent name="onShow">//var orgId=&quot;000000&quot;;&#xD;
//var selectionPatrolTaskItem = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
//var para={&#xD;
//	&quot;orgId&quot;:orgId,&#xD;
//	&quot;selectionPatrolTaskItem&quot;:selectionPatrolTaskItem&#xD;
//}&#xD;
&#xD;
&#xD;
//view.get(&quot;#dsPatrolPoint&quot;).set(&quot;parameter&quot;, para).flushAsync();&#xD;
//view.get(&quot;#dsUserAmount&quot;).set(&quot;parameter&quot;, para).flushAsync();</ClientEvent>
              <Property name="center">true</Property>
              <Property name="maximizeable">true</Property>
              <Property name="width">1200</Property>
              <Property name="height">600</Property>
              <Property name="modal">true</Property>
              <Property name="closeable">true</Property>
              <Property name="caption">巡防任务项配置</Property>
              <Property name="maximized">true</Property>
              <Buttons>
                <Button>
                  <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogPatrolTaskItemConfig&quot;);
dialog.hide();
view.get(&quot;#dsPointTaskItem&quot;).flushAsync(); </ClientEvent>
                  <Property name="caption">关闭</Property>
                  <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
                  <Property name="ui">decline</Property>
                </Button>
                <Button>
                  <ClientEvent name="onClick">var nodes = view.get(&quot;#dtOrg&quot;).getCheckedNodes();&#xD;
var orgCodes = [];&#xD;
if (nodes &amp;&amp; nodes.length) {&#xD;
    nodes.each(function(data){&#xD;
        orgCodes.push(data.get(&quot;data.code&quot;));&#xD;
    });&#xD;
}&#xD;
var patrolTaskItems = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
if (orgCodes.length > 0) {&#xD;
    //if (selectionPatrolTaskItem.length == 0){&#xD;
    //	throw new dorado.Exception(&quot;请先选择任务项&quot;);&#xD;
    //}&#xD;
    var dsPatrolPoint = view.get(&quot;#dsPatrolPoint&quot;).getData();&#xD;
    var formUserAmount = view.get(&quot;#dsUserAmount&quot;).getData();&#xD;
    var paraSave = {&#xD;
        'orgIds': orgCodes,&#xD;
        'selectionPatrolTaskItem': patrolTaskItems,&#xD;
        'dsPatrolPoint': dsPatrolPoint,&#xD;
        'formUserAmount': formUserAmount&#xD;
    }&#xD;
    view.get(&quot;#aaSave&quot;).set(&quot;parameter&quot;, paraSave).execute(function(){&#xD;
    &#xD;
    });&#xD;
}&#xD;
&#xD;
else {&#xD;
    throw new dorado.Exception(&quot;请先选择单位&quot;);&#xD;
}&#xD;
</ClientEvent>
                  <Property name="caption">确定</Property>
                  <Property name="iconClass">fa fa-check-circle</Property>
                  <Property name="ui">highlight</Property>
                </Button>
              </Buttons>
              <Children>
                <VerticalTabControl>
                  <Property name="tabColumnWidth">100</Property>
                  <ControlTab>
                    <Property name="caption">人员</Property>
                    <Property name="iconClass">fa fa-users</Property>
                    <SplitPanel>
                      <Property name="position">65%</Property>
                      <MainControl>
                        <GroupBox>
                          <Property name="caption">按人员数量设置</Property>
                          <Buttons/>
                          <Children>
                            <DataGrid id="userAmountDataGrid">
                              <Property name="dataSet">dsUserAmount</Property>
                              <DataColumn name="orgId">
                                <Property name="property">orgId</Property>
                                <Property name="readOnly">true</Property>
                                <Property name="align">left</Property>
                              </DataColumn>
                              <DataColumn>
                                <Property name="property">orgName</Property>
                                <Property name="readOnly">true</Property>
                                <Property name="align">left</Property>
                                <Property name="name">orgName</Property>
                                <Property name="name">orgName</Property>
                              </DataColumn>
                              <DataColumn name="memberAmount">
                                <Property name="property">memberAmount</Property>
                                <Property name="align">center</Property>
                              </DataColumn>
                              <DataColumn name="copAmount">
                                <Property name="property">copAmount</Property>
                                <Property name="align">center</Property>
                              </DataColumn>
                              <DataColumn name="apAmount">
                                <Property name="property">apAmount</Property>
                                <Property name="align">center</Property>
                              </DataColumn>
                            </DataGrid>
                          </Children>
                        </GroupBox>
                      </MainControl>
                      <SideControl>
                        <Container>
                          <SplitPanel>
                            <Property name="position">55%</Property>
                            <MainControl>
                              <GroupBox>
                                <Property name="caption">组织单位</Property>
                                <Buttons/>
                                <Children>
                                  <ToolBar>
                                    <Property name="visible">false</Property>
                                    <Property name="hideMode">display</Property>
                                    <Fill/>
                                  </ToolBar>
                                  <DataTree id="dtOrg" layoutConstraint="padding:15">
                                    <ClientEvent name="onRenderNode">var data = arg.node.get(&quot;data&quot;);
//var icon = data.get(&quot;icon&quot;) || &quot;&quot;;

var icon='fa fa-building yellow-text';
arg.node.set(&quot;iconClass&quot;, icon);
$(arg.dom).text(data.get(&quot;name&quot;) || &quot;&quot;);
</ClientEvent>
                                    <ClientEvent name="onNodeCheckedChange">var nodeData = arg.node._data.getData();
var code = nodeData.code;
var name = nodeData.name;
if (arg.node._checked) {
    console.log(arg.node._data.getData());
    var entity = view.get(&quot;#dsUserAmount&quot;).getData().insert();
    entity.set(&quot;orgId&quot;, code);
    entity.set(&quot;orgName&quot;, name);
}
else {
    console.log(arg.node._data.getData());
    var dsUserAmounts = view.get(&quot;#dsUserAmount&quot;).getData();
    dsUserAmounts.each(function(entity){
        console.log(entity.getData());
		if (code == entity.getData().orgId){
			entity.remove();
		}
    })
}
</ClientEvent>
                                    <ClientEvent name="onDataNodeCreate">var selectionPatrolTaskItem = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);

var nodes = view.get(&quot;#dtOrg&quot;).getCheckedNodes();
var orgCodes = [];
if (nodes &amp;&amp; nodes.length) {
    var cur;
    nodes.each(function(data){
        orgCodes.push(data.get(&quot;data.code&quot;));
        cur = data;
    });
    view.get(&quot;#dtOrg&quot;).set(&quot;currentNode&quot;, cur);
    var para = {
        'selectionPatrolTaskItem': selectionPatrolTaskItem,
        &quot;orgIds&quot;: orgCodes
    }
    view.get(&quot;#dsUserAmount&quot;).set(&quot;parameter&quot;, para).flushAsync();
    // var data = view.get(&quot;#formConditionPatrolPoint.entity&quot;);
    var param = {
        'selectionPatrolTaskItem': selectionPatrolTaskItem,
    }
    //data.set(&quot;selectionPatrolTaskItem&quot;, selectionPatrolTaskItem);
    view.get(&quot;#dsPatrolPoint&quot;).set(&quot;parameter&quot;, param).flushAsync();
    
}
else {
    var para = {
        'selectionPatrolTaskItem': selectionPatrolTaskItem,
        &quot;orgIds&quot;: orgCodes
    }
    view.get(&quot;#dsUserAmount&quot;).set(&quot;parameter&quot;, para).flushAsync();
}

</ClientEvent>
                                    <Property name="dataSet">dsOrg</Property>
                                    <Property name="showLines">true</Property>
                                    <Property name="selectionMode">singleRow</Property>
                                    <Property name="useNativeScrollbars">true</Property>
                                    <Property name="expandingAnimated">true</Property>
                                    <Property name="allowNoCurrent">true</Property>
                                    <BindingConfigs>
                                      <BindingConfig>
                                        <Property name="childrenProperty">children</Property>
                                        <Property name="labelProperty">name</Property>
                                        <Property name="recursive">true</Property>
                                        <Property name="tipProperty">address</Property>
                                        <Property name="name">code</Property>
                                        <Property name="checkable">true</Property>
                                        <Property name="checkedProperty">checked</Property>
                                        <Property name="autoCheckChildren">false</Property>
                                        <Property name="expandLevel">2</Property>
                                      </BindingConfig>
                                    </BindingConfigs>
                                  </DataTree>
                                </Children>
                              </GroupBox>
                            </MainControl>
                            <SideControl>
                              <GroupBox>
                                <Property name="caption">巡防点</Property>
                                <Buttons/>
                                <Children>
                                  <AutoForm id="formConditionPatrolPoint">
                                    <ClientEvent name="onKeyDown">&#xD;
if (arg.keyCode === 13) {&#xD;
    window.clearTimeout(self.urlQueryTimeout);&#xD;
    self.urlQueryTimeout = window.setTimeout(function(){&#xD;
    &#xD;
        var data = view.get(&quot;#formConditionPatrolPoint.entity&quot;);&#xD;
        var selectionPatrolTaskItem = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
        data.set(&quot;selectionPatrolTaskItem&quot;, selectionPatrolTaskItem);&#xD;
        view.get(&quot;#dsPatrolPoint&quot;).set(&quot;parameter&quot;, data).flushAsync();&#xD;
        &#xD;
    }, 250);&#xD;
}&#xD;
</ClientEvent>
                                    <Property name="labelWidth">100</Property>
                                    <Property name="cols">*</Property>
                                    <Property name="createPrivateDataSet">true</Property>
                                    <Property name="dataType">ConditionPatrolPoint</Property>
                                    <Property name="labelAlign">center</Property>
                                    <Property name="showHint">false</Property>
                                    <AutoFormElement id="batchCode">
                                      <Property name="name">code</Property>
                                      <Property name="property">code</Property>
                                      <Property name="trigger">triggerSearchCode</Property>
                                      <Editor/>
                                    </AutoFormElement>
                                    <AutoFormElement id="batchName">
                                      <Property name="name">name</Property>
                                      <Property name="property">name</Property>
                                      <Property name="trigger">triggerSearchName</Property>
                                      <Editor/>
                                    </AutoFormElement>
                                    <AutoFormElement>
                                      <Property name="name">pointTaskItemId</Property>
                                      <Property name="property">pointTaskItemId</Property>
                                      <Property name="hideMode">display</Property>
                                      <Property name="visible">false</Property>
                                      <Editor/>
                                    </AutoFormElement>
                                    <AutoFormElement>
                                      <Property name="name">selectionPatrolTaskItem</Property>
                                      <Property name="property">selectionPatrolTaskItem</Property>
                                      <Property name="visible">false</Property>
                                      <Property name="hideMode">display</Property>
                                      <Editor/>
                                    </AutoFormElement>
                                  </AutoForm>
                                  <ToolBar>
                                    <Property name="fixRight">true</Property>
                                    <ToolBarButton>
                                      <ClientEvent name="onClick">var data = view.get(&quot;#formConditionPatrolPoint.entity&quot;);&#xD;
var items = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
var param = {&#xD;
    'selectionPatrolTaskItem': items,&#xD;
    'code': data.get(&quot;code&quot;),&#xD;
    'name': data.get(&quot;name&quot;)&#xD;
}&#xD;
view.get(&quot;#dsPatrolPoint&quot;).set(&quot;parameter&quot;, param).flushAsync();&#xD;
</ClientEvent>
                                      <Property name="caption">查询</Property>
                                      <Property name="iconClass">fa fa-search</Property>
                                    </ToolBarButton>
                                  </ToolBar>
                                  <DataGrid id="dgPatrolPoint">
                                    <Property name="dataSet">dsPatrolPoint</Property>
                                    <Property name="selectionMode">multiRows</Property>
                                    <Property name="highlightCurrentRow">false</Property>
                                    <DataColumn name="checked">
                                      <Property name="property">checked</Property>
                                      <Property name="align">center</Property>
                                      <Property name="width">40</Property>
                                    </DataColumn>
                                    <DataColumn name="编码">
                                      <Property name="caption">编码</Property>
                                      <Property name="property">code</Property>
                                      <Property name="align">left</Property>
                                      <Property name="readOnly">true</Property>
                                      <Property name="width">40</Property>
                                    </DataColumn>
                                    <DataColumn name="名称">
                                      <Property name="caption">名称</Property>
                                      <Property name="property">name</Property>
                                      <Property name="align">left</Property>
                                      <Property name="readOnly">true</Property>
                                    </DataColumn>
                                  </DataGrid>
                                  <Trigger id="triggerSearchCode">
                                    <ClientEvent name="onExecute">var taBatchInput=view.get(&quot;#taBatchInputCode&quot;);&#xD;
var fpBatchInput=view.get(&quot;#fpBatchInputCode&quot;);&#xD;
&#xD;
fpBatchInput.show({&#xD;
  anchorTarget: view.get(&quot;#batchCode&quot;),&#xD;
  vAlign: &quot;bottom&quot;,&#xD;
  offsetLeft: 100&#xD;
});&#xD;
&#xD;
taBatchInput.set(&quot;text&quot;,&quot;&quot;);&#xD;
&#xD;
arg.returnValue = false;&#xD;
</ClientEvent>
                                    <Property name="iconClass">fa fa-list-ol</Property>
                                  </Trigger>
                                  <FloatPanel id="fpBatchInputCode">
                                    <Property name="width">190</Property>
                                    <Property name="showAnimateType">slide</Property>
                                    <Property name="shadowMode">sides</Property>
                                    <Property name="closeable">true</Property>
                                    <Property name="showCaptionBar">true</Property>
                                    <Property name="height">300</Property>
                                    <Property name="caption">巡防点ID列表(一行一个)</Property>
                                    <Buttons>
                                      <Button>
                                        <ClientEvent name="onClick">var taBatchInputCode=view.get(&quot;#taBatchInputCode&quot;);&#xD;
var batchInputCode=taBatchInputCode.get(&quot;text&quot;);&#xD;
var codeResult=batchInputCode.replace(/\n/g,&quot;,&quot;);&#xD;
view.get(&quot;#formConditionPatrolPoint.entity&quot;).set(&quot;code&quot;,codeResult);&#xD;
&#xD;
var fpBatchInputCode=view.get(&quot;#fpBatchInputCode&quot;);&#xD;
fpBatchInputCode.hide();</ClientEvent>
                                        <Property name="caption">确定</Property>
                                        <Property name="ui">highlight</Property>
                                      </Button>
                                    </Buttons>
                                    <Children>
                                      <TextArea id="taBatchInputCode"/>
                                    </Children>
                                    <Tools/>
                                  </FloatPanel>
                                  <Trigger id="triggerSearchName">
                                    <ClientEvent name="onExecute">var taBatchInput=view.get(&quot;#taBatchInputName&quot;);&#xD;
var fpBatchInput=view.get(&quot;#fpBatchInputName&quot;);&#xD;
&#xD;
fpBatchInput.show({&#xD;
  anchorTarget: view.get(&quot;#batchName&quot;),&#xD;
  vAlign: &quot;bottom&quot;,&#xD;
  offsetLeft: 100&#xD;
});&#xD;
&#xD;
taBatchInput.set(&quot;text&quot;,&quot;&quot;);&#xD;
&#xD;
arg.returnValue = false;&#xD;
</ClientEvent>
                                    <Property name="iconClass">fa fa-list-ol</Property>
                                  </Trigger>
                                  <FloatPanel id="fpBatchInputName">
                                    <Property name="width">190</Property>
                                    <Property name="showAnimateType">slide</Property>
                                    <Property name="shadowMode">sides</Property>
                                    <Property name="closeable">true</Property>
                                    <Property name="showCaptionBar">true</Property>
                                    <Property name="height">300</Property>
                                    <Property name="caption">巡防点名称列表(一行一个)</Property>
                                    <Buttons>
                                      <Button>
                                        <ClientEvent name="onClick">var taBatchInputName=view.get(&quot;#taBatchInputName&quot;);&#xD;
var batchInputName=taBatchInputName.get(&quot;text&quot;);&#xD;
var nameResult=batchInputName.replace(/\n/g,&quot;,&quot;);&#xD;
view.get(&quot;#formConditionPatrolPoint.entity&quot;).set(&quot;name&quot;,nameResult);&#xD;
&#xD;
var fpBatchInputName=view.get(&quot;#fpBatchInputName&quot;);&#xD;
fpBatchInputName.hide();</ClientEvent>
                                        <Property name="caption">确定</Property>
                                        <Property name="ui">highlight</Property>
                                      </Button>
                                    </Buttons>
                                    <Children>
                                      <TextArea id="taBatchInputName"/>
                                    </Children>
                                    <Tools/>
                                  </FloatPanel>
                                </Children>
                              </GroupBox>
                            </SideControl>
                          </SplitPanel>
                        </Container>
                      </SideControl>
                    </SplitPanel>
                  </ControlTab>
                  <ControlTab>
                    <Property name="caption">已有任务</Property>
                    <Property name="iconClass">icon-clipboard</Property>
                    <DataGrid>
                      <Property name="dataSet">dsOrgPlan</Property>
                      <Property name="selectionMode">multiRows</Property>
                      <Property name="highlightCurrentRow">false</Property>
                      <Property name="highlightHoverRow">false</Property>
                      <Property name="highlightSelectedRow">false</Property>
                      <Property name="readOnly">true</Property>
                      <RowNumColumn>
                        <Property name="width">60</Property>
                      </RowNumColumn>
                      <DataColumn name="orgName">
                        <Property name="property">org.name</Property>
                        <Property name="align">center</Property>
                        <Property name="caption">单位名称</Property>
                      </DataColumn>
                      <DataColumn name="patrolStartTime">
                        <Property name="property">patrolStartTime</Property>
                        <Property name="align">center</Property>
                      </DataColumn>
                      <DataColumn name="patrolEndTime">
                        <Property name="property">patrolEndTime</Property>
                        <Property name="align">center</Property>
                      </DataColumn>
                    </DataGrid>
                  </ControlTab>
                </VerticalTabControl>
              </Children>
              <Tools/>
            </Dialog>
            <Dialog id="dialogCopyItem">
              <ClientEvent name="onClose">var data=view.get(&quot;#dsPatrolTask&quot;).getData();&#xD;
var dialog=view.get(&quot;#dialogCopy&quot;);&#xD;
data.cancel();&#xD;
dialog.hide();</ClientEvent>
              <Property name="center">true</Property>
              <Property name="maximizeable">true</Property>
              <Property name="width">1024</Property>
              <Property name="height">400</Property>
              <Property name="modal">true</Property>
              <Property name="closeable">true</Property>
              <Property name="caption">复制任务项</Property>
              <Buttons>
                <Button>
                  <ClientEvent name="onClick">var data=view.get(&quot;#dsPointTaskItem&quot;).getData();
var dialog=view.get(&quot;#dialogCopyItem&quot;);
data.cancel();
dialog.hide();</ClientEvent>
                  <Property name="caption">关闭</Property>
                  <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
                  <Property name="ui">decline</Property>
                </Button>
                <Button>
                  <ClientEvent name="onClick">var selection = view.get(&quot;#dgPointTaskItem&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
var entity = view.get(&quot;#dgPointTaskItem&quot;).getCurrentItem();&#xD;
var pointTaskItemId = entity.get(&quot;id&quot;);&#xD;
var copy = view.get(&quot;#formCopyItem.entity&quot;);&#xD;
&#xD;
var parameter={&#xD;
	&quot;selection&quot;:selection,&#xD;
	&quot;id&quot;:pointTaskItemId,&#xD;
	&quot;patrolStartTime&quot;:copy.get(&quot;patrolStartTime&quot;),&#xD;
	&quot;patrolEndTime&quot;:copy.get(&quot;patrolEndTime&quot;)&#xD;
}&#xD;
view.get(&quot;#aaCopyItem&quot;).set(&quot;parameter&quot;, parameter).execute(function(result) {&#xD;
    view.get(&quot;#dialogCopyItem&quot;).hide();&#xD;
    with(view.get(&quot;#dsPointTaskItem&quot;)) {&#xD;
        flushAsync();&#xD;
    }&#xD;
});</ClientEvent>
                  <Property name="caption">确定</Property>
                  <Property name="iconClass">fa fa-check-circle</Property>
                  <Property name="ui">highlight</Property>
                </Button>
              </Buttons>
              <Children>
                <AutoForm id="formCopyItem">
                  <Property name="labelWidth">100</Property>
                  <Property name="cols">*,*</Property>
                  <Property name="labelAlign">center</Property>
                  <Property name="showHint">false</Property>
                  <Property name="showHintMessage">true</Property>
                  <Property name="dataType">CopyItem</Property>
                  <Property name="createPrivateDataSet">true</Property>
                  <AutoFormElement name="patrolStartTime">
                    <Property name="name">patrolStartTime</Property>
                    <Property name="property">patrolStartTime</Property>
                    <Property name="label">巡访开始时间</Property>
                    <Editor>
                      <DateTimeSpinner>
                        <ClientEvent name="onCreate">self.set(&quot;value&quot;, new Date());&#xD;
</ClientEvent>
                        <Property name="type">time</Property>
                      </DateTimeSpinner>
                    </Editor>
                  </AutoFormElement>
                  <AutoFormElement name="patrolEndTime">
                    <Property name="name">patrolEndTime</Property>
                    <Property name="property">patrolEndTime</Property>
                    <Property name="label">巡访结束时间</Property>
                    <Editor>
                      <DateTimeSpinner>
                        <ClientEvent name="onCreate">self.set(&quot;value&quot;, new Date());&#xD;
</ClientEvent>
                        <Property name="type">time</Property>
                      </DateTimeSpinner>
                    </Editor>
                  </AutoFormElement>
                </AutoForm>
              </Children>
              <Tools/>
            </Dialog>
            <Dialog id="dialogTaskItemTimeConfig">
              <ClientEvent name="onClose">var data=view.get(&quot;#dsPointTaskItem&quot;).getData();&#xD;
data.cancel();</ClientEvent>
              <Property name="center">true</Property>
              <Property name="maximizeable">true</Property>
              <Property name="width">1024</Property>
              <Property name="height">500</Property>
              <Property name="modal">true</Property>
              <Property name="closeable">true</Property>
              <Property name="caption">巡防任务项详情</Property>
              <Buttons>
                <Button>
                  <ClientEvent name="onClick">var data=view.get(&quot;#dsPointTaskItem&quot;).getData();
var dialog=view.get(&quot;#dialogTaskItemTimeConfig&quot;);
data.cancel();
dialog.hide();</ClientEvent>
                  <Property name="caption">关闭</Property>
                  <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
                  <Property name="ui">decline</Property>
                </Button>
                <Button>
                  <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogTaskItemTimeConfig&quot;);&#xD;
var action=view.get(&quot;#uaPatrolTaskItem&quot;);&#xD;
action.execute(function(){&#xD;
dialog.hide();&#xD;
view.get(&quot;#dsPointTaskItem&quot;).flushAsync(); &#xD;
})&#xD;
</ClientEvent>
                  <Property name="caption">确定</Property>
                  <Property name="iconClass">fa fa-check-circle</Property>
                  <Property name="ui">highlight</Property>
                </Button>
              </Buttons>
              <Children>
                <AutoForm>
                  <Property name="labelWidth">100</Property>
                  <Property name="dataSet">dsPointTaskItem</Property>
                  <Property name="cols">*,*</Property>
                  <Property name="labelAlign">center</Property>
                  <Property name="showHint">false</Property>
                  <Property name="showHintMessage">true</Property>
                  <AutoFormElement>
                    <Property name="name">timeInterval</Property>
                    <Property name="property">timeInterval</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">timeRedundancy</Property>
                    <Property name="property">timeRedundancy</Property>
                    <Editor/>
                  </AutoFormElement>
                </AutoForm>
              </Children>
              <Tools/>
            </Dialog>
          </Children>
          <Tools/>
        </Panel>
      </MainControl>
      <SideControl>
        <Panel>
          <Property name="caption">任务</Property>
          <Buttons/>
          <Children>
            <AutoForm id="formCondition">
              <ClientEvent name="onKeyDown">if (arg.keyCode === 13) {&#xD;
window.clearTimeout(self.urlQueryTimeout);&#xD;
self.urlQueryTimeout = window.setTimeout(function() {&#xD;
var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
with (view.get(&quot;#dsPatrolTask&quot;)) {&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}&#xD;
}, 250);&#xD;
}</ClientEvent>
              <Property name="labelWidth">120</Property>
              <Property name="cols">*,*</Property>
              <Property name="createPrivateDataSet">true</Property>
              <Property name="dataType">Condition</Property>
              <Property name="labelAlign">center</Property>
              <Property name="showHint">false</Property>
              <AutoFormElement>
                <Property name="name">name</Property>
                <Property name="label">任务名称</Property>
                <Editor/>
              </AutoFormElement>
              <AutoFormElement>
                <Property name="name">activeStatus</Property>
                <Property name="property">activeStatus</Property>
                <Editor/>
              </AutoFormElement>
            </AutoForm>
            <ToolBar>
              <Property name="fixRight">true</Property>
              <ToolBarButton>
                <ClientEvent name="onClick">var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
with (view.get(&quot;#dsPatrolTask&quot;)){&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}</ClientEvent>
                <Property name="caption">查询</Property>
                <Property name="iconClass">fa fa-search</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var datas = view.get(&quot;#dsPatrolTask.data&quot;);&#xD;
datas.insert();&#xD;
view.get(&quot;#dialogPatrolTask&quot;).show();&#xD;
arg.processDefault=false;</ClientEvent>
                <Property name="caption">新增</Property>
                <Property name="iconClass">fa fa-plus</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var updateAction=view.get(&quot;#updateAction&quot;);&#xD;
var selection = view.get(&quot;#dgPatrolTask&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
if(0 != selection.length) {&#xD;
dorado.MessageBox.confirm(&quot;确认操作吗?&quot;,function(){&#xD;
&#xD;
for (var i = 0; i &lt; selection.length; i++) {&#xD;
var select = selection[i];&#xD;
select.remove();&#xD;
}&#xD;
&#xD;
updateAction.execute();&#xD;
view.get(&quot;#dsPatrolTask&quot;).flushAsync(); &#xD;
})&#xD;
&#xD;
} else {&#xD;
dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
                <Property name="iconClass">fa fa-trash-o</Property>
                <Property name="caption">删除(批量)</Property>
              </ToolBarButton>
              <ToolBarButton>
                <ClientEvent name="onClick">var selection = view.get(&quot;#dgPatrolTask&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
if(0 != selection.length) {&#xD;
view.get(&quot;#dialogCopy&quot;).show();&#xD;
&#xD;
} else {&#xD;
dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
                <Property name="caption">复制(批量)</Property>
                <Property name="iconClass">fa fa-copy</Property>
              </ToolBarButton>
              <Fill/>
              <DataPilot>
                <Property name="dataSet">dsPatrolTask</Property>
                <Property name="itemCodes">pages,pageSize</Property>
              </DataPilot>
            </ToolBar>
            <DataGrid id="dgPatrolTask">
              <ClientEvent name="onDataRowClick">view.get(&quot;#dsPointTaskItem&quot;).flushAsync(); </ClientEvent>
              <Property name="dataSet">dsPatrolTask</Property>
              <Property name="dataType">PointTask</Property>
              <Property name="selectionMode">multiRows</Property>
              <Property name="readOnly">true</Property>
              <RowSelectorColumn/>
              <RowNumColumn/>
              <DataColumn name="任务名称">
                <Property name="caption">任务名称</Property>
                <Property name="property">name</Property>
                <Property name="align">center</Property>
              </DataColumn>
              <DataColumn name="巡访开始时间">
                <Property name="caption">巡访开始时间</Property>
                <Property name="property">patrolStartDate</Property>
                <Property name="align">center</Property>
              </DataColumn>
              <DataColumn name="巡访结束时间">
                <Property name="caption">巡访结束时间</Property>
                <Property name="property">patrolEndDate</Property>
                <Property name="align">center</Property>
              </DataColumn>
              <DataColumn>
                <Property name="property">activeStatus</Property>
                <Property name="align">center</Property>
                <Property name="name">activeStatus</Property>
              </DataColumn>
            </DataGrid>
            <Dialog id="dialogPatrolTask">
              <ClientEvent name="onClose">var data=view.get(&quot;#dsPatrolTask&quot;).getData();&#xD;
data.cancel();&#xD;
&#xD;
</ClientEvent>
              <Property name="center">true</Property>
              <Property name="maximizeable">true</Property>
              <Property name="width">1024</Property>
              <Property name="height">500</Property>
              <Property name="modal">true</Property>
              <Property name="closeable">true</Property>
              <Property name="caption">巡防任务详情</Property>
              <Buttons>
                <Button>
                  <ClientEvent name="onClick">var data=view.get(&quot;#dsPatrolTask&quot;).getData();
var dialog=view.get(&quot;#dialogPatrolTask&quot;);
data.cancel();
dialog.hide();</ClientEvent>
                  <Property name="caption">关闭</Property>
                  <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
                  <Property name="ui">decline</Property>
                </Button>
                <Button>
                  <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogPatrolTask&quot;);&#xD;
var action=view.get(&quot;#updateAction&quot;);&#xD;
action.execute(function(){&#xD;
view.get(&quot;#dsPatrolTask&quot;).flush(); &#xD;
view.get(&quot;#dsPointTaskItem&quot;).flush(); &#xD;
dialog.hide();&#xD;
&#xD;
})</ClientEvent>
                  <Property name="caption">确定</Property>
                  <Property name="iconClass">fa fa-check-circle</Property>
                  <Property name="ui">highlight</Property>
                </Button>
              </Buttons>
              <Children>
                <AutoForm id="formMain">
                  <Property name="labelWidth">100</Property>
                  <Property name="dataSet">dsPatrolTask</Property>
                  <Property name="cols">*,*</Property>
                  <Property name="labelAlign">center</Property>
                  <Property name="showHint">false</Property>
                  <Property name="showHintMessage">true</Property>
                  <AutoFormElement name="name">
                    <Property name="name">name</Property>
                    <Property name="property">name</Property>
                    <Property name="label">任务名称</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">patrolStartDate</Property>
                    <Property name="property">patrolStartDate</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">patrolEndDate</Property>
                    <Property name="property">patrolEndDate</Property>
                    <Editor/>
                  </AutoFormElement>
                </AutoForm>
                <CustomDropDown id="dropDownSlider">
                  <Property name="height">22</Property>
                  <Slider>
                    <ClientEvent name="onValueChange">var dropdown = dorado.widget.DropDown.findDropDown(self);&#xD;
var editor = dropdown.get(&quot;editor&quot;);&#xD;
dropdown.close(self.get(&quot;value&quot;));</ClientEvent>
                  </Slider>
                </CustomDropDown>
              </Children>
              <Tools/>
            </Dialog>
            <Dialog id="dialogCopy">
              <ClientEvent name="onClose">var data=view.get(&quot;#dsPatrolTask&quot;).getData();&#xD;
var dialog=view.get(&quot;#dialogCopy&quot;);&#xD;
data.cancel();&#xD;
dialog.hide();</ClientEvent>
              <Property name="center">true</Property>
              <Property name="maximizeable">true</Property>
              <Property name="width">1024</Property>
              <Property name="height">400</Property>
              <Property name="modal">true</Property>
              <Property name="closeable">true</Property>
              <Property name="caption">复制任务</Property>
              <Buttons>
                <Button>
                  <ClientEvent name="onClick">var data=view.get(&quot;#dsPatrolTask&quot;).getData();
var dialog=view.get(&quot;#dialogCopy&quot;);
data.cancel();
dialog.hide();</ClientEvent>
                  <Property name="caption">关闭</Property>
                  <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
                  <Property name="ui">decline</Property>
                </Button>
                <Button>
                  <ClientEvent name="onClick">var selection = view.get(&quot;#dgPatrolTask&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
var entity = view.get(&quot;#dgPatrolTask&quot;).getCurrentItem();&#xD;
var pointTaskId = entity.get(&quot;id&quot;);&#xD;
var copy = view.get(&quot;#formCopy.entity&quot;);&#xD;
&#xD;
var parameter={&#xD;
	&quot;selection&quot;:selection,&#xD;
	&quot;id&quot;:pointTaskId,&#xD;
	&quot;patrolStartDate&quot;:copy.get(&quot;patrolStartDate&quot;),&#xD;
	&quot;patrolEndDate&quot;:copy.get(&quot;patrolEndDate&quot;)&#xD;
}&#xD;
view.get(&quot;#aaCopy&quot;).set(&quot;parameter&quot;, parameter).execute(function(result) {&#xD;
    view.get(&quot;#dialogCopy&quot;).hide();&#xD;
    var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
    with(view.get(&quot;#dsPatrolTask&quot;)) {&#xD;
        set(&quot;parameter&quot;, data);&#xD;
        flushAsync();&#xD;
    }&#xD;
});</ClientEvent>
                  <Property name="caption">确定</Property>
                  <Property name="iconClass">fa fa-check-circle</Property>
                  <Property name="ui">highlight</Property>
                </Button>
              </Buttons>
              <Children>
                <AutoForm id="formCopy">
                  <Property name="labelWidth">100</Property>
                  <Property name="cols">*,*</Property>
                  <Property name="labelAlign">center</Property>
                  <Property name="showHint">false</Property>
                  <Property name="showHintMessage">true</Property>
                  <Property name="dataType">Copy</Property>
                  <Property name="createPrivateDataSet">true</Property>
                  <AutoFormElement>
                    <Property name="name">patrolStartDate</Property>
                    <Property name="property">patrolStartDate</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">patrolEndDate</Property>
                    <Property name="property">patrolEndDate</Property>
                    <Editor/>
                  </AutoFormElement>
                </AutoForm>
              </Children>
              <Tools/>
            </Dialog>
          </Children>
          <Tools/>
        </Panel>
      </SideControl>
    </SplitPanel>
  </View>
</ViewConfig>
