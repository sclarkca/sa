<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="SpecialTask">
      <Property name="creationType">com.mr.sa.entity.SpecialTask</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">任务名称</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="taskStartTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">任务开始时间</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="taskEndTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">任务结束时间</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="doneRatio">
        <Property name="dataType">Integer</Property>
        <Property name="label">完成比例(%)</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property></Property>
        <Property name="label">创建日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property></Property>
        <Property name="label">修改日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="type">
        <Property></Property>
        <Property name="label">任务类型</Property>
      </PropertyDef>
      <PropertyDef name="checked">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否选中</Property>
      </PropertyDef>
    </DataType>
    <DataType name="Condition">
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">任务名称</Property>
      </PropertyDef>
      <PropertyDef name="taskStartTime_startTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">任务开始时间(起)</Property>
      </PropertyDef>
      <PropertyDef name="taskStartTime_endTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">任务开始时间(至)</Property>
      </PropertyDef>
      <PropertyDef name="taskStartTime">
        <Property name="dataType">String</Property>
        <Property name="label">任务开始时间</Property>
      </PropertyDef>
      <PropertyDef name="taskEndTime_startTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">任务结束时间(起)</Property>
      </PropertyDef>
      <PropertyDef name="taskEndTime_endTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">任务结束时间(至)</Property>
      </PropertyDef>
      <PropertyDef name="taskEndTime">
        <Property name="dataType">String</Property>
        <Property name="label">任务结束时间</Property>
      </PropertyDef>
      <PropertyDef name="doneRatio">
        <Property name="dataType">String</Property>
        <Property name="label">完成比例(%)</Property>
      </PropertyDef>
    </DataType>
    <DataType name="Org">
      <Property name="creationType">com.mr.sa.entity.Org</Property>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">ID</Property>
      </PropertyDef>
      <PropertyDef name="code">
        <Property></Property>
        <Property name="label">编码</Property>
        <Property name="required">true</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property></Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="parentId">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="longitude">
        <Property></Property>
        <Property name="label">经度</Property>
      </PropertyDef>
      <PropertyDef name="latitude">
        <Property></Property>
        <Property name="label">纬度</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property></Property>
        <Property name="label">地址</Property>
      </PropertyDef>
      <Reference name="children">
        <Property name="dataType">[SELF]</Property>
        <Property name="dataProvider">specialTaskController#loadChildrenOrg</Property>
        <Property name="parameter">
          <Entity>
            <Property name="parentId">$${this.id}</Property>
          </Entity>
        </Property>
      </Reference>
      <PropertyDef name="checked">
        <Property name="dataType">boolean</Property>
      </PropertyDef>
    </DataType>
    <DataType name="User">
      <Property name="creationType">com.mr.sa.entity.app.AppUser</Property>
      <PropertyDef name="checked">
        <ClientEvent name="onSet">var entity = view.get(&quot;#dgSpecialTask&quot;).getCurrentItem();&#xD;
var specialTaskId = entity.get(&quot;id&quot;);&#xD;
&#xD;
var node=view.get(&quot;#dtOrg&quot;).getCurrentItem().get(&quot;data&quot;);&#xD;
var orgId=node.get(&quot;code&quot;);&#xD;
 &#xD;
&#xD;
&#xD;
var paraSave = {&#xD;
	'specialTaskId': specialTaskId,&#xD;
	'username': arg.entity.get(&quot;username&quot;),&#xD;
	'orgId':orgId&#xD;
}&#xD;
&#xD;
if (arg.value) {&#xD;
	view.get(&quot;#aaSaveUser&quot;).set(&quot;parameter&quot;, paraSave).execute(function(result) {})&#xD;
} else {&#xD;
	view.get(&quot;#aaDeleteUser&quot;).set(&quot;parameter&quot;, paraSave).execute(function(result) {&#xD;
	})&#xD;
}</ClientEvent>
        <Property name="dataType">boolean</Property>
        <Property name="label">是否选中</Property>
      </PropertyDef>
      <PropertyDef name="username">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="nickname">
        <Property></Property>
        <Property name="label">姓名</Property>
      </PropertyDef>
      <PropertyDef name="password">
        <Property></Property>
      </PropertyDef>
      <PropertyDef name="enabled">
        <Property name="dataType">boolean</Property>
      </PropertyDef>
      <PropertyDef name="roleId">
        <Property></Property>
        <Property name="label">角色</Property>
      </PropertyDef>
      <PropertyDef name="orgId">
        <Property></Property>
        <Property name="label">组织</Property>
      </PropertyDef>
      <PropertyDef name="gender">
        <Property></Property>
        <Property name="label">性别</Property>
      </PropertyDef>
      <PropertyDef name="phone">
        <Property></Property>
        <Property name="label">电话</Property>
      </PropertyDef>
      <PropertyDef name="mail">
        <Property></Property>
        <Property name="label">邮箱</Property>
      </PropertyDef>
      <PropertyDef name="address">
        <Property></Property>
        <Property name="label">住址</Property>
      </PropertyDef>
      <PropertyDef name="remark">
        <Property></Property>
        <Property name="label">备注</Property>
      </PropertyDef>
      <PropertyDef name="id">
        <Property></Property>
        <Property name="label">id</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="avatar">
        <Property></Property>
        <Property name="label">头像</Property>
      </PropertyDef>
    </DataType>
    <DataType name="SpecialTaskRecord">
      <Property name="creationType">com.mr.sa.entity.SpecialTaskRecord</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="specialTaskId">
        <Property name="dataType">String</Property>
        <Property name="label">专项任务ID</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">任务名称</Property>
      </PropertyDef>
      <PropertyDef name="userId">
        <Property name="dataType">String</Property>
        <Property name="label">执行人ID</Property>
      </PropertyDef>
      <PropertyDef name="userName">
        <Property name="dataType">String</Property>
        <Property name="label">执行人姓名</Property>
      </PropertyDef>
      <PropertyDef name="userAmmount">
        <Property name="dataType">Integer</Property>
        <Property name="label">任务人数</Property>
      </PropertyDef>
      <PropertyDef name="description">
        <Property name="dataType">String</Property>
        <Property name="label">任务描述</Property>
      </PropertyDef>
      <PropertyDef name="dutyTime">
        <Property name="dataType">DateTime</Property>
        <Property name="label">到岗时间</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property></Property>
        <Property name="label">创建日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property></Property>
        <Property name="label">修改日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="importDetail">
        <Property></Property>
        <Property name="label">导入详情</Property>
      </PropertyDef>
    </DataType>
    <DataType name="PatrolPoint">
      <ClientEvent name="onDataChange">var itemEntity = view.get(&quot;#dgSpecialTask&quot;).getCurrentItem();&#xD;
var specialTaskId = itemEntity.get(&quot;id&quot;);&#xD;
&#xD;
var node=view.get(&quot;#dtOrg&quot;).getCurrentItem().get(&quot;data&quot;);&#xD;
var orgId=node.get(&quot;code&quot;);&#xD;
&#xD;
var paraSave = {&#xD;
	'specialTaskId': specialTaskId,&#xD;
	'patrolPoint': arg.entity,&#xD;
	'orgId':orgId&#xD;
}&#xD;
if(arg.value){&#xD;
	//arg.entity.set(&quot;checked&quot;, true);&#xD;
}&#xD;
&#xD;
view.get(&quot;#aaSavePoint&quot;).set(&quot;parameter&quot;, paraSave).execute();</ClientEvent>
      <Property name="creationType">com.mr.sa.entity.PatrolPoint</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="code">
        <Property name="dataType">String</Property>
        <Property name="label">编码</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="longitude">
        <Property name="dataType">String</Property>
        <Property name="label">经度</Property>
      </PropertyDef>
      <PropertyDef name="latitude">
        <Property name="dataType">String</Property>
        <Property name="label">纬度</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property></Property>
        <Property name="label">创建日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property></Property>
        <Property name="label">修改日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="importDetail">
        <Property></Property>
        <Property name="label">导入详情</Property>
      </PropertyDef>
      <PropertyDef name="checked">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否选中</Property>
      </PropertyDef>
      <PropertyDef name="required">
        <Property name="dataType">boolean</Property>
        <Property name="label">是否为必扫点</Property>
      </PropertyDef>
    </DataType>
    <DataType name="SpecialTaskType">
      <Property name="creationType">com.mr.sa.entity.SpecialTaskType</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="createdDate">
        <Property></Property>
        <Property name="label">创建日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="creator">
        <Property></Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="updateDate">
        <Property></Property>
        <Property name="label">修改日期</Property>
        <Property name="dataType">DateTime</Property>
      </PropertyDef>
      <PropertyDef name="modifier">
        <Property></Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
      <PropertyDef name="importDetail">
        <Property></Property>
        <Property name="label">导入详情</Property>
      </PropertyDef>
    </DataType>
    <DataType name="ConditionPatrolPoint">
      <PropertyDef name="code">
        <Property name="dataType">String</Property>
        <Property name="label">编码</Property>
      </PropertyDef>
      <PropertyDef name="name">
        <Property name="dataType">String</Property>
        <Property name="label">名称</Property>
      </PropertyDef>
      <PropertyDef name="specialTaskId"/>
    </DataType>
  </Model>
  <View>
    <Property name="packages">font-awesome,colors,entypo</Property>
    <Property name="title">专项任务信息维护</Property>
    <Container id="ds">
      <DataSet id="dsOrg">
        <Property name="dataProvider">specialTaskController#loadOrg</Property>
        <Property name="dataType">[Org]</Property>
      </DataSet>
      <DataSet id="dsSpecialTask">
        <Property name="dataProvider">specialTaskController#query</Property>
        <Property name="pageSize">20</Property>
        <Property name="dataType">[SpecialTask]</Property>
        <Property name="loadMode">lazy</Property>
      </DataSet>
      <DataSet id="dsSpecialTaskUser">
        <Property name="dataType">[User]</Property>
        <Property name="dataProvider">specialTaskController#querySpecialTaskUser</Property>
        <Property name="loadMode">manual</Property>
      </DataSet>
      <DataSet id="dsSpecialTaskUserAll">
        <Property name="dataType">[User]</Property>
        <Property name="dataProvider">specialTaskController#querySpecialTaskUserAll</Property>
        <Property name="loadMode">manual</Property>
      </DataSet>
      <DataSet id="dsSpecialTaskRecord">
        <ClientEvent name="beforeLoadData">var entity = view.get(&quot;#dsSpecialTask&quot;).getData(&quot;#&quot;); &#xD;
var specialTaskId=entity.get(&quot;id&quot;);&#xD;
var paraQuery = {&#xD;
	'specialTaskId_eq': specialTaskId&#xD;
}&#xD;
self.set(&quot;parameter&quot;, paraQuery);&#xD;
</ClientEvent>
        <Property name="dataProvider">specialTaskRecordController#query</Property>
        <Property name="pageSize">20</Property>
        <Property name="dataType">[SpecialTaskRecord]</Property>
        <Property name="loadMode">manual</Property>
      </DataSet>
      <DataSet id="dsPatrolPoint">
        <Property name="dataProvider">specialTaskController#querySpecialTaskPoint</Property>
        <Property name="dataType">[PatrolPoint]</Property>
        <Property name="loadMode">manual</Property>
        <Property name="pageSize">15</Property>
      </DataSet>
      <DataSet id="dsSpecialTaskType">
        <Property name="dataProvider">specialTaskTypeController#query</Property>
        <Property name="pageSize">1000</Property>
        <Property name="dataType">[SpecialTaskType]</Property>
        <Property name="loadMode">lazy</Property>
      </DataSet>
    </Container>
    <Container id="action">
      <AjaxAction id="aaSaveUser">
        <Property name="service">specialTaskService#saveUser</Property>
        <Property name="async">false</Property>
      </AjaxAction>
      <AjaxAction id="aaDeleteUser">
        <Property name="service">specialTaskService#deleteUser</Property>
        <Property name="async">false</Property>
      </AjaxAction>
      <UpdateAction id="updateAction">
        <Property name="successMessage">操作成功!</Property>
        <Property name="executingMessage">正在保存...</Property>
        <Property name="dataResolver">specialTaskController#save</Property>
        <UpdateItem>
          <Property name="dataSet">dsSpecialTask</Property>
        </UpdateItem>
      </UpdateAction>
      <AjaxAction id="aaSavePoint">
        <Property name="service">specialTaskService#savePoint</Property>
        <Property name="async">false</Property>
      </AjaxAction>
    </Container>
    <AutoForm id="formCondition">
      <ClientEvent name="onKeyDown">if (arg.keyCode === 13) {&#xD;
window.clearTimeout(self.urlQueryTimeout);&#xD;
self.urlQueryTimeout = window.setTimeout(function() {&#xD;
var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
with (view.get(&quot;#dsSpecialTask&quot;)) {&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}&#xD;
}, 250);&#xD;
}</ClientEvent>
      <Property name="labelWidth">120</Property>
      <Property name="cols">*,*,*,*</Property>
      <Property name="createPrivateDataSet">true</Property>
      <Property name="dataType">Condition</Property>
      <Property name="labelAlign">center</Property>
      <Property name="showHint">false</Property>
      <AutoFormElement>
        <Property name="name">name</Property>
        <Property name="label">任务名称</Property>
        <Editor/>
      </AutoFormElement>
      <AutoFormElement>
        <Property name="name">taskStartTime_startTime</Property>
        <Property name="label">任务开始时间(起)</Property>
        <Editor/>
      </AutoFormElement>
      <AutoFormElement>
        <Property name="name">taskStartTime_endTime</Property>
        <Property name="label">任务开始时间(至)</Property>
        <Editor/>
      </AutoFormElement>
      <AutoFormElement>
        <Property name="name">taskEndTime_startTime</Property>
        <Property name="label">任务结束时间(起)</Property>
        <Editor/>
      </AutoFormElement>
      <AutoFormElement>
        <Property name="name">taskEndTime_endTime</Property>
        <Property name="label">任务结束时间(至)</Property>
        <Editor/>
      </AutoFormElement>
    </AutoForm>
    <ToolBar>
      <Property name="fixRight">true</Property>
      <ToolBarButton>
        <ClientEvent name="onClick">var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
with (view.get(&quot;#dsSpecialTask&quot;)){&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}</ClientEvent>
        <Property name="caption">查询</Property>
        <Property name="iconClass">fa fa-search</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var datas = view.get(&quot;#dsSpecialTask.data&quot;);&#xD;
datas.insert();&#xD;
view.get(&quot;#dialogSpecialTask&quot;).show();&#xD;
arg.processDefault=false;</ClientEvent>
        <Property name="caption">新增</Property>
        <Property name="iconClass">fa fa-plus</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var data=view.get(&quot;#dsSpecialTask.data&quot;);&#xD;
if(data.current){&#xD;
view.get(&quot;#dialogSpecialTask&quot;).show();&#xD;
}else{&#xD;
dorado.MessageBox.alert(&quot;当前表没有信息可供编辑!&quot;);&#xD;
}</ClientEvent>
        <Property name="caption">修改</Property>
        <Property name="iconClass">fa fa-pencil-square-o</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var entity = view.get(&quot;#dsSpecialTask&quot;).getData(&quot;#&quot;);
var specialTaskId=entity.get(&quot;id&quot;);
var paraQuery = {
	'specialTaskId': specialTaskId
}
view.get(&quot;#dialogSpecialTaskUser&quot;).show();
</ClientEvent>
        <Property name="caption">执行设置</Property>
        <Property name="iconClass">fa fa-sitemap</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var entity = view.get(&quot;#dsSpecialTask&quot;).getData(&quot;#&quot;);
var specialTaskId=entity.get(&quot;id&quot;);
var paraQuery = {
	'specialTaskId': specialTaskId
}
view.get(&quot;#dsSpecialTaskUserAll&quot;).set(&quot;parameter&quot;, paraQuery).flushAsync();
view.get(&quot;#dsSpecialTaskRecord&quot;).set(&quot;parameter&quot;, paraQuery).flushAsync();

var path="";
view.get(&quot;#iFrame&quot;).set(&quot;path&quot;, path);
view.get(&quot;#dialogSpecialTaskDetail&quot;).show();
</ClientEvent>
        <Property name="caption">详情</Property>
        <Property name="iconClass">fa fa-eye</Property>
      </ToolBarButton>
      <ToolBarButton>
        <ClientEvent name="onClick">var updateAction=view.get(&quot;#updateAction&quot;);&#xD;
var selection = view.get(&quot;#dgSpecialTask&quot;).get(&quot;selection&quot;);&#xD;
&#xD;
if(0 != selection.length) {&#xD;
dorado.MessageBox.confirm(&quot;确认操作吗?&quot;,function(){&#xD;
&#xD;
for (var i = 0; i &lt; selection.length; i++) {&#xD;
var select = selection[i];&#xD;
select.remove();&#xD;
}&#xD;
&#xD;
updateAction.execute();&#xD;
view.get(&quot;#dsSpecialTask&quot;).flushAsync(); &#xD;
})&#xD;
&#xD;
} else {&#xD;
dorado.MessageBox.alert(&quot;请选择需要操作的记录！&quot;);&#xD;
}&#xD;
&#xD;
&#xD;
</ClientEvent>
        <Property name="iconClass">fa fa-trash-o</Property>
        <Property name="caption">删除(批量)</Property>
      </ToolBarButton>
      <Fill/>
      <DataPilot>
        <Property name="dataSet">dsSpecialTask</Property>
        <Property name="itemCodes">pages,pageSize</Property>
      </DataPilot>
    </ToolBar>
    <DataGrid id="dgSpecialTask">
      <Property name="dataSet">dsSpecialTask</Property>
      <Property name="dataType">SpecialTask</Property>
      <Property name="selectionMode">multiRows</Property>
      <Property name="readOnly">true</Property>
      <RowSelectorColumn/>
      <RowNumColumn/>
      <DataColumn name="任务名称">
        <Property name="caption">任务名称</Property>
        <Property name="property">name</Property>
        <Property name="align">center</Property>
      </DataColumn>
      <DataColumn>
        <Property name="property">type</Property>
        <Property name="name">任务类型</Property>
        <Property name="align">center</Property>
      </DataColumn>
      <DataColumn name="任务开始时间">
        <Property name="caption">任务开始时间</Property>
        <Property name="property">taskStartTime</Property>
        <Property name="align">center</Property>
      </DataColumn>
      <DataColumn name="任务结束时间">
        <Property name="caption">任务结束时间</Property>
        <Property name="property">taskEndTime</Property>
        <Property name="align">center</Property>
      </DataColumn>
      <DataColumn name="完成比例(%)">
        <Property name="caption">完成比例(%)</Property>
        <Property name="property">doneRatio</Property>
        <Property name="align">center</Property>
      </DataColumn>
    </DataGrid>
    <Dialog id="dialogSpecialTask">
      <ClientEvent name="onClose">var data=view.get(&quot;#dsSpecialTask&quot;).getData();&#xD;
data.cancel();&#xD;
</ClientEvent>
      <Property name="center">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="width">1024</Property>
      <Property name="height">500</Property>
      <Property name="modal">true</Property>
      <Property name="closeable">true</Property>
      <Property name="caption">详情</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var data=view.get(&quot;#dsSpecialTask&quot;).getData();
var dialog=view.get(&quot;#dialogSpecialTask&quot;);
data.cancel();
dialog.hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
          <Property name="ui">decline</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogSpecialTask&quot;);&#xD;
var action=view.get(&quot;#updateAction&quot;);&#xD;
action.execute(function(){&#xD;
dialog.hide();&#xD;
view.get(&quot;#dsSpecialTask&quot;).flushAsync(); &#xD;
})</ClientEvent>
          <Property name="caption">确定</Property>
          <Property name="iconClass">fa fa-check-circle</Property>
          <Property name="ui">highlight</Property>
        </Button>
      </Buttons>
      <Children>
        <AutoForm id="formMain">
          <Property name="labelWidth">100</Property>
          <Property name="dataSet">dsSpecialTask</Property>
          <Property name="cols">*,*</Property>
          <Property name="labelAlign">center</Property>
          <Property name="showHint">false</Property>
          <Property name="showHintMessage">true</Property>
          <AutoFormElement name="name">
            <Property name="name">name</Property>
            <Property name="property">name</Property>
            <Property name="label">任务名称</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement name="doneRatio">
            <Property name="name">doneRatio</Property>
            <Property name="property">doneRatio</Property>
            <Property name="label">完成比例(%)</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement name="taskStartTime">
            <Property name="name">taskStartTime</Property>
            <Property name="property">taskStartTime</Property>
            <Property name="label">任务开始时间</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement name="taskEndTime">
            <Property name="name">taskEndTime</Property>
            <Property name="property">taskEndTime</Property>
            <Property name="label">任务结束时间</Property>
            <Editor/>
          </AutoFormElement>
          <AutoFormElement layoutConstraint="colSpan:2">
            <Property name="name">type</Property>
            <Property name="property">type</Property>
            <Property name="editorType">TextArea</Property>
            <Property name="height">200</Property>
            <Editor>
              <TagEditor>
                <Property name="availableTagsDataSet">dsSpecialTaskType</Property>
                <Property name="availableTagsDataPath">.name</Property>
              </TagEditor>
            </Editor>
          </AutoFormElement>
        </AutoForm>
      </Children>
      <Tools/>
    </Dialog>
    <Dialog id="dialogSpecialTaskUser">
      <ClientEvent name="onClose">var data=view.get(&quot;#dsSpecialTask&quot;).getData();&#xD;
data.cancel();&#xD;
</ClientEvent>
      <ClientEvent name="onShow">var entity = view.get(&quot;#dsSpecialTask&quot;).getData(&quot;#&quot;); &#xD;
var specialTaskId=entity.get(&quot;id&quot;);&#xD;
var data = view.get(&quot;#formConditionPatrolPoint.entity&quot;);&#xD;
data.set(&quot;specialTaskId&quot;,specialTaskId);&#xD;
with (view.get(&quot;#dsPatrolPoint&quot;)){&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}&#xD;
&#xD;
</ClientEvent>
      <Property name="center">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="width">1200</Property>
      <Property name="height">650</Property>
      <Property name="modal">true</Property>
      <Property name="closeable">true</Property>
      <Property name="caption">执行人配置</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogSpecialTaskUser&quot;);
dialog.hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
          <Property name="ui">decline</Property>
        </Button>
      </Buttons>
      <Children>
        <VerticalTabControl>
          <Property name="tabColumnWidth">120</Property>
          <ControlTab>
            <Property name="caption">人员</Property>
            <Property name="iconClass">fa fa-users</Property>
            <SplitPanel>
              <Property name="position">30%</Property>
              <MainControl>
                <TabControl>
                  <ControlTab>
                    <Property name="caption">执行人</Property>
                    <Property name="iconClass">icon-users</Property>
                    <Panel>
                      <Buttons/>
                      <Children>
                        <ToolBar>
                          <ToolBarButton>
                            <ClientEvent name="onClick">var dsUser=view.get(&quot;#dsSpecialTaskUser&quot;).getData();&#xD;
dsUser.each(function(entity){&#xD;
	entity.set(&quot;checked&quot;,self.get(&quot;toggled&quot;))&#xD;
}); </ClientEvent>
                            <Property name="caption">全选</Property>
                            <Property name="iconClass">fa fa-check</Property>
                            <Property name="toggleable">true</Property>
                            <Property name="tags">op</Property>
                          </ToolBarButton>
                        </ToolBar>
                        <DataGrid>
                          <Property name="dataSet">dsSpecialTaskUser</Property>
                          <Property name="sortMode">clientSide</Property>
                          <Property name="filterMode">clientSide</Property>
                          <Property name="highlightCurrentRow">false</Property>
                          <RowNumColumn>
                            <Property name="width">60</Property>
                          </RowNumColumn>
                          <DataColumn>
                            <Property name="property">checked</Property>
                            <Property name="align">center</Property>
                            <Property name="name">checked</Property>
                          </DataColumn>
                          <DataColumn>
                            <ClientEvent name="onRenderCell">$(arg.dom).empty().xCreate(&#xD;
			{&#xD;
				tagName : &quot;IMG&quot;,&#xD;
				src : arg.data.get(&quot;avatar&quot;),&#xD;
				//style : &quot;margin: 2px&quot;&#xD;
				style : &quot;width: 30px; height: 30px; margin: 1px&quot;&#xD;
			});&#xD;
&#xD;
	dorado.TipManager.initTip(arg.dom.parentNode, {&#xD;
		content : {&#xD;
			tagName : &quot;IMG&quot;,&#xD;
			src : arg.data.get(&quot;avatar&quot;),&#xD;
			style : &quot;width: 120px; height: 120px; margin: 2px&quot;&#xD;
		},&#xD;
		arrowDirection : &quot;top&quot;,&#xD;
		arrowAlign : &quot;left&quot;&#xD;
	});</ClientEvent>
                            <Property name="property">avatar</Property>
                            <Property name="align">center</Property>
                            <Property name="caption">头像</Property>
                            <Property name="width">80</Property>
                            <Property name="name">avatar</Property>
                          </DataColumn>
                          <DataColumn>
                            <Property name="property">nickname</Property>
                            <Property name="name">nickname</Property>
                            <Property name="align">center</Property>
                            <Property name="readOnly">true</Property>
                          </DataColumn>
                          <DataColumn name="gender">
                            <Property name="property">gender</Property>
                            <Property name="align">center</Property>
                            <Property name="readOnly">true</Property>
                          </DataColumn>
                          <DataColumn name="phone">
                            <Property name="property">phone</Property>
                            <Property name="align">center</Property>
                            <Property name="readOnly">true</Property>
                          </DataColumn>
                        </DataGrid>
                      </Children>
                      <Tools/>
                    </Panel>
                  </ControlTab>
                </TabControl>
              </MainControl>
              <SideControl>
                <Container>
                  <ToolBar>
                    <ToolBarLabel>
                      <Property name="text">选择组织</Property>
                      <Property name="exClassName">blue-text</Property>
                    </ToolBarLabel>
                    <Fill/>
                    <Tip>
                      <Property name="floating">false</Property>
                      <Property name="text">点击组织联动执行人</Property>
                    </Tip>
                  </ToolBar>
                  <DataTree id="dtOrg" layoutConstraint="padding:15">
                    <ClientEvent name="onRenderNode">var data = arg.node.get(&quot;data&quot;);
//var icon = data.get(&quot;icon&quot;) || &quot;&quot;;

var icon='fa fa-building yellow-text';
arg.node.set(&quot;iconClass&quot;, icon);
$(arg.dom).text(data.get(&quot;name&quot;) || &quot;&quot;);
</ClientEvent>
                    <ClientEvent name="onDataRowClick">var node=view.get(&quot;#dtOrg&quot;).getCurrentItem().get(&quot;data&quot;);&#xD;
var orgId=node.get(&quot;code&quot;);&#xD;
var entity = view.get(&quot;#dsSpecialTask&quot;).getData(&quot;#&quot;); &#xD;
var specialTaskId=entity.get(&quot;id&quot;);&#xD;
var paraUser={&#xD;
	&quot;orgId&quot;:orgId,&#xD;
	&quot;specialTaskId&quot;:specialTaskId&#xD;
}&#xD;
&#xD;
view.get(&quot;#dsSpecialTaskUser&quot;).set(&quot;parameter&quot;, paraUser).flushAsync();&#xD;
&#xD;
var paraPatrolPoint={&#xD;
	&quot;specialTaskId&quot;:specialTaskId&#xD;
}&#xD;
view.get(&quot;#dsPatrolPoint&quot;).set(&quot;parameter&quot;, paraPatrolPoint).flushAsync();&#xD;
</ClientEvent>
                    <Property name="dataSet">dsOrg</Property>
                    <Property name="currentNodeDataPath">currentNode</Property>
                    <Property name="showLines">true</Property>
                    <Property name="selectionMode">singleRow</Property>
                    <Property name="useNativeScrollbars">true</Property>
                    <Property name="allowNoCurrent">true</Property>
                    <BindingConfigs>
                      <BindingConfig>
                        <Property name="childrenProperty">children</Property>
                        <Property name="labelProperty">name</Property>
                        <Property name="recursive">true</Property>
                        <Property name="tipProperty">address</Property>
                        <Property name="name">code</Property>
                        <Property name="checkedProperty">checked</Property>
                        <Property name="autoCheckChildren">false</Property>
                      </BindingConfig>
                    </BindingConfigs>
                  </DataTree>
                </Container>
              </SideControl>
            </SplitPanel>
          </ControlTab>
          <ControlTab>
            <Property name="caption">巡防点</Property>
            <Property name="iconClass">icon-cone</Property>
            <Panel>
              <Buttons/>
              <Children>
                <AutoForm id="formConditionPatrolPoint">
                  <Property name="labelWidth">100</Property>
                  <Property name="cols">*,*,*,*</Property>
                  <Property name="createPrivateDataSet">true</Property>
                  <Property name="dataType">ConditionPatrolPoint</Property>
                  <Property name="labelAlign">center</Property>
                  <Property name="showHint">false</Property>
                  <AutoFormElement>
                    <Property name="name">code</Property>
                    <Property name="property">code</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">name</Property>
                    <Property name="property">name</Property>
                    <Editor/>
                  </AutoFormElement>
                  <AutoFormElement>
                    <Property name="name">specialTaskId</Property>
                    <Property name="property">specialTaskId</Property>
                    <Property name="hideMode">display</Property>
                    <Property name="visible">false</Property>
                    <Editor/>
                  </AutoFormElement>
                </AutoForm>
                <ToolBar>
                  <ToolBarButton>
                    <ClientEvent name="onClick">var entity = view.get(&quot;#dsSpecialTask&quot;).getData(&quot;#&quot;); &#xD;
var specialTaskId=entity.get(&quot;id&quot;);&#xD;
var data = view.get(&quot;#formConditionPatrolPoint.entity&quot;);&#xD;
data.set(&quot;specialTaskId&quot;,specialTaskId);&#xD;
with (view.get(&quot;#dsPatrolPoint&quot;)){&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}&#xD;
&#xD;
</ClientEvent>
                    <Property name="caption">查询</Property>
                    <Property name="iconClass">fa fa-search</Property>
                  </ToolBarButton>
                  <Fill/>
                  <DataPilot>
                    <Property name="dataSet">dsPatrolPoint</Property>
                    <Property name="itemCodes">pages,pageSize</Property>
                  </DataPilot>
                </ToolBar>
                <DataGrid id="dgPatrolPoint">
                  <Property name="dataSet">dsPatrolPoint</Property>
                  <Property name="selectionMode">multiRows</Property>
                  <Property name="highlightCurrentRow">false</Property>
                  <RowNumColumn/>
                  <DataColumn name="checked">
                    <Property name="property">checked</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="编码">
                    <Property name="caption">编码</Property>
                    <Property name="property">code</Property>
                    <Property name="align">center</Property>
                    <Property name="readOnly">true</Property>
                  </DataColumn>
                  <DataColumn name="名称">
                    <Property name="caption">名称</Property>
                    <Property name="property">name</Property>
                    <Property name="align">center</Property>
                    <Property name="readOnly">true</Property>
                  </DataColumn>
                  <DataColumn name="required">
                    <Property name="property">required</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                </DataGrid>
              </Children>
              <Tools/>
            </Panel>
          </ControlTab>
        </VerticalTabControl>
      </Children>
      <Tools/>
    </Dialog>
    <Dialog id="dialogSpecialTaskDetail">
      <ClientEvent name="onClose">var data=view.get(&quot;#dsSpecialTask&quot;).getData();&#xD;
data.cancel();&#xD;
</ClientEvent>
      <Property name="center">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="width">1200</Property>
      <Property name="height">600</Property>
      <Property name="modal">true</Property>
      <Property name="closeable">true</Property>
      <Property name="caption">详情</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var dialog=view.get(&quot;#dialogSpecialTaskDetail&quot;);
dialog.hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="iconClass">fa fa-arrow-circle-o-left</Property>
          <Property name="ui">decline</Property>
        </Button>
      </Buttons>
      <Children>
        <VerticalTabControl>
          <Property name="tabColumnWidth">130</Property>
          <ControlTab>
            <Property name="caption">基本信息</Property>
            <Property name="iconClass">icon-target&#xD;
icon-target</Property>
            <AutoForm id="formDetail">
              <Property name="labelWidth">100</Property>
              <Property name="dataSet">dsSpecialTask</Property>
              <Property name="cols">*,*</Property>
              <Property name="labelAlign">center</Property>
              <Property name="showHint">false</Property>
              <Property name="showHintMessage">true</Property>
              <Property name="readOnly">true</Property>
              <AutoFormElement name="name">
                <Property name="name">name</Property>
                <Property name="property">name</Property>
                <Property name="label">任务名称</Property>
                <Editor/>
              </AutoFormElement>
              <AutoFormElement>
                <Property name="name">type</Property>
                <Property name="property">type</Property>
                <Editor/>
              </AutoFormElement>
              <AutoFormElement name="taskStartTime">
                <Property name="name">taskStartTime</Property>
                <Property name="property">taskStartTime</Property>
                <Property name="label">任务开始时间</Property>
                <Editor/>
              </AutoFormElement>
              <AutoFormElement name="taskEndTime">
                <Property name="name">taskEndTime</Property>
                <Property name="property">taskEndTime</Property>
                <Property name="label">任务结束时间</Property>
                <Editor/>
              </AutoFormElement>
              <AutoFormElement name="doneRatio">
                <Property name="name">doneRatio</Property>
                <Property name="property">doneRatio</Property>
                <Property name="label">完成比例(%)</Property>
                <Editor/>
              </AutoFormElement>
              <AutoFormElement>
                <Property name="visible">false</Property>
                <Editor/>
              </AutoFormElement>
            </AutoForm>
          </ControlTab>
          <ControlTab>
            <Property name="caption">执行人汇总</Property>
            <Property name="iconClass">icon-users</Property>
            <Panel>
              <Buttons/>
              <Children>
                <DataGrid>
                  <Property name="dataSet">dsSpecialTaskUserAll</Property>
                  <Property name="sortMode">clientSide</Property>
                  <Property name="filterMode">clientSide</Property>
                  <Property name="highlightCurrentRow">false</Property>
                  <Property name="readOnly">true</Property>
                  <RowNumColumn>
                    <Property name="width">60</Property>
                  </RowNumColumn>
                  <DataColumn>
                    <ClientEvent name="onRenderCell">$(arg.dom).empty().xCreate(&#xD;
			{&#xD;
				tagName : &quot;IMG&quot;,&#xD;
				src : arg.data.get(&quot;avatar&quot;),&#xD;
				//style : &quot;margin: 2px&quot;&#xD;
				style : &quot;width: 30px; height: 30px; margin: 1px&quot;&#xD;
			});&#xD;
&#xD;
	dorado.TipManager.initTip(arg.dom.parentNode, {&#xD;
		content : {&#xD;
			tagName : &quot;IMG&quot;,&#xD;
			src : arg.data.get(&quot;avatar&quot;),&#xD;
			style : &quot;width: 120px; height: 120px; margin: 2px&quot;&#xD;
		},&#xD;
		arrowDirection : &quot;top&quot;,&#xD;
		arrowAlign : &quot;left&quot;&#xD;
	});</ClientEvent>
                    <Property name="property">avatar</Property>
                    <Property name="align">center</Property>
                    <Property name="caption">头像</Property>
                    <Property name="width">80</Property>
                    <Property name="name">avatar</Property>
                  </DataColumn>
                  <DataColumn name="username">
                    <Property name="property">username</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn>
                    <Property name="property">nickname</Property>
                    <Property name="name">nickname</Property>
                    <Property name="align">center</Property>
                    <Property name="readOnly">true</Property>
                  </DataColumn>
                  <DataColumn name="gender">
                    <Property name="property">gender</Property>
                    <Property name="align">center</Property>
                    <Property name="readOnly">true</Property>
                  </DataColumn>
                  <DataColumn name="phone">
                    <Property name="property">phone</Property>
                    <Property name="align">center</Property>
                    <Property name="readOnly">true</Property>
                  </DataColumn>
                  <DataColumn name="orgId">
                    <Property name="property">orgId</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                </DataGrid>
              </Children>
              <Tools/>
            </Panel>
          </ControlTab>
          <ControlTab>
            <Property name="caption">任务执行情况</Property>
            <Property name="iconClass">icon-flashlight</Property>
            <Panel>
              <Buttons/>
              <Children>
                <ToolBar>
                  <ToolBarButton>
                    <ClientEvent name="onClick">var data = view.get(&quot;#formCondition.entity&quot;);&#xD;
with (view.get(&quot;#dsSpecialTaskRecord&quot;)){&#xD;
set(&quot;parameter&quot;, data);&#xD;
flushAsync();&#xD;
}</ClientEvent>
                    <Property name="caption">查询</Property>
                    <Property name="iconClass">fa fa-search</Property>
                  </ToolBarButton>
                  <Fill/>
                  <DataPilot>
                    <Property name="dataSet">dsSpecialTaskRecord</Property>
                    <Property name="itemCodes">pages,pageSize</Property>
                  </DataPilot>
                </ToolBar>
                <DataGrid id="dgSpecialTaskRecord">
                  <Property name="dataSet">dsSpecialTaskRecord</Property>
                  <Property name="dataType">SpecialTaskRecord</Property>
                  <Property name="selectionMode">multiRows</Property>
                  <Property name="readOnly">true</Property>
                  <RowSelectorColumn/>
                  <RowNumColumn/>
                  <DataColumn name="任务名称">
                    <Property name="caption">任务名称</Property>
                    <Property name="property">name</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="执行人ID">
                    <Property name="caption">执行人ID</Property>
                    <Property name="property">userId</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="执行人姓名">
                    <Property name="caption">执行人姓名</Property>
                    <Property name="property">userName</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="任务人数">
                    <Property name="caption">任务人数</Property>
                    <Property name="property">userAmmount</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="任务描述">
                    <Property name="caption">任务描述</Property>
                    <Property name="property">description</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                  <DataColumn name="到岗时间">
                    <Property name="caption">到岗时间</Property>
                    <Property name="property">dutyTime</Property>
                    <Property name="align">center</Property>
                  </DataColumn>
                </DataGrid>
              </Children>
              <Tools/>
            </Panel>
          </ControlTab>
          <ControlTab>
            <Property name="caption">地图</Property>
            <Property name="iconClass">fa fa-map-marker</Property>
            <Panel>
              <Buttons/>
              <Children>
                <Panel>
                  <Buttons/>
                  <Children>
                    <IFrame id="iFrame"/>
                  </Children>
                  <Tools/>
                </Panel>
              </Children>
              <Tools/>
            </Panel>
          </ControlTab>
        </VerticalTabControl>
      </Children>
      <Tools/>
    </Dialog>
  </View>
</ViewConfig>
